var MediaOverlay={contentUrl:null,moUrl:null,audioMap:{},spine:[],current:null,onclipend:function(){var a=null;for(var b=0;b<MediaOverlay.spine.length-1;b++)if(MediaOverlay.spine[b]===MediaOverlay.current){a=MediaOverlay.spine[b+1];break}MediaOverlay.current=null,a!==null&&MediaOverlay.oncontentclick.call($("#"+a))},oncontentclick:function(){$("."+MediaOverlay.cssPrefix+"Highlight").removeClass(MediaOverlay.cssPrefix+"Highlight");for(var a in MediaOverlay.audioMap)MediaOverlay.audioMap[a].stop();MediaOverlay.current===null?($(this).addClass(MediaOverlay.cssPrefix+"Highlight"),MediaOverlay.audioMap[$(this).attr("data-mo-href")].play([$(this).attr("id")]),MediaOverlay.current=$(this).attr("id")):MediaOverlay.current=null}};$(function(){MediaOverlay.contentUrl=new URI(window.location.href),MediaOverlay.moUrl=(new URI($("link[rel=mediaoverlay]").attr("href"))).resolve(MediaOverlay.contentUrl),MediaOverlay.cssPrefix=$("meta[name='mediaoverlay.css-prefix']").attr("content"),MediaOverlay.autoplay=$("meta[name='mediaoverlay.autoplay']").attr("content")==="true",$.ajax({url:MediaOverlay.moUrl.toString(),success:function(a,b,c){clips=a.getElementsByTagName("par");var d={};MediaOverlay.audioMap={};for(var e=0;e<clips.length;e++){var f=clips[e],g=f.getElementsByTagName("text")[0].getAttribute("src").split("#");typeof d[g[0]]=="undefined"&&(d[g[0]]=(new URI(g[0])).resolve(MediaOverlay.contentUrl).toString());if(d[g[0]]!==MediaOverlay.contentUrl.toString())continue;var h=f.getElementsByTagName("audio")[0].getAttribute("src").split("#");typeof d[h[0]]=="undefined"&&(d[h[0]]=(new URI(h[0])).resolve(MediaOverlay.contentUrl).toString(),MediaOverlay.audioMap[d[h[0]]]={urls:[d[h[0]]],autoplay:!1,onend:MediaOverlay.onclipend,sprite:{}});var i=f.getElementsByTagName("audio")[0].getAttribute("clipBegin").split(":");i.length===3?i=Number(i[0])*3600+Number(i[1])*60+Number(i[2]):i.length===2?i=Number(i[0])*60+Number(i[1]):i=Number(i[0]),i*=1e3;var j=f.getElementsByTagName("audio")[0].getAttribute("clipEnd").split(":");j.length===3?j=Number(j[0])*3600+Number(j[1])*60+Number(j[2]):j.length===2?j=Number(j[0])*60+Number(j[1]):j=Number(j[0]),j*=1e3,MediaOverlay.audioMap[d[h[0]]].sprite[g[1]]=[i,j-i],MediaOverlay.spine.push(g[1]);var k=$("#"+g[1]);k.attr("data-mo-href",d[h[0]]),k.attr("data-mo-clipBegin",i),k.attr("data-mo-clipBegin",j);var l=$(k).parents();for(var m=0;m<l.length;m++);$("#"+g[1]).click(MediaOverlay.oncontentclick)}for(var n in MediaOverlay.audioMap)MediaOverlay.audioMap[n]=new Howl(MediaOverlay.audioMap[n]);MediaOverlay.autoplay&&MediaOverlay.oncontentclick.call($("#"+MediaOverlay.spine[0]))},dataType:"xml"})});